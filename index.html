<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ê–∫–∞–¥–µ–º–∏—è</title>
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #a29bfe;
            --accent: #ffeaa7;
            --danger: #ff7675;
            --success: #00b894;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle at center, #1a1a2e, #16213e, #0f3460);
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            user-select: none;
        }

        /* --- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å --- */
        header {
            width: 100%;
            padding: 10px 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            gap: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            z-index: 10;
        }

        .stat-badge {
            background: rgba(255, 255, 255, 0.1);
            padding: 5px 15px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            font-weight: bold;
            font-size: 1rem;
        }

        #timer-container {
            width: 100%;
            height: 10px;
            background: #2d3436;
        }

        #timer-bar {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent), var(--danger));
            transition: width 1s linear;
        }

        #game-area {
            flex: 1;
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –ú–ï–ú–û–†–ò --- */
        .memory-grid {
            display: grid;
            gap: 10px;
            perspective: 1000px;
        }
        .card {
            width: 70px;
            height: 70px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
            cursor: pointer;
        }
        .card.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .card-front { background: linear-gradient(135deg, var(--primary), #4834d4); border: 2px solid rgba(255,255,255,0.1); }
        .card-back { background: white; transform: rotateY(180deg); border: 2px solid var(--accent); }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –ú–ê–¢–ï–ú–ê–¢–ò–ö–ò --- */
        .math-container {
            text-align: center;
            background: rgba(0,0,0,0.4);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid var(--secondary);
            width: 100%;
            max-width: 400px;
        }
        .math-problem {
            font-size: 3rem;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 0 0 10px var(--primary);
        }
        .math-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        .math-btn {
            background: white;
            color: var(--primary);
            font-size: 1.5rem;
            font-weight: bold;
            padding: 15px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: 0.2s;
        }
        .math-btn:hover { transform: scale(1.05); background: var(--accent); }
        .math-btn:active { transform: scale(0.95); }

        /* --- –°—Ç–∏–ª–∏ –¥–ª—è –†–ï–ê–ö–¶–ò–ò (–ê—Å—Ç–µ—Ä–æ–∏–¥—ã) --- */
        .asteroid-field {
            width: 100%;
            height: 60vh;
            position: relative;
            overflow: hidden;
            border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 15px;
        }
        .asteroid {
            position: absolute;
            font-size: 3rem;
            cursor: pointer;
            animation: float 3s infinite ease-in-out;
            transition: transform 0.1s;
        }
        .asteroid:active { transform: scale(0.8); }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* --- –ö–æ–ª–ª–µ–∫—Ü–∏—è –∏ –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ --- */
        #gift-bar {
            width: 90%;
            max-width: 600px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px 15px 0 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            min-height: 50px;
        }
        .gift-item { font-size: 1.5rem; animation: popIn 0.5s; }
        
        .modal {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 12, 41, 0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        .modal h1 { color: var(--accent); margin-bottom: 10px; }
        .big-gift { font-size: 5rem; margin: 20px; animation: spin 2s infinite linear; }
        @keyframes spin { from {transform: rotate(0deg);} to {transform: rotate(360deg);} }
        
        button.action-btn {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(108, 92, 231, 0.5);
            margin-top: 20px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤ */
        @media (min-width: 600px) {
            .card { width: 100px; height: 100px; font-size: 3rem; }
        }
    </style>
</head>
<body>

    <div id="timer-container"><div id="timer-bar"></div></div>

    <header>
        <div class="stat-badge">–£—Ä–æ–≤–µ–Ω—å: <span id="lvl-val">1</span></div>
        <div class="stat-badge">–°—á–µ—Ç: <span id="score-val">0</span></div>
    </header>

    <div id="game-area">
        <!-- –°—é–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–≥—Ä–∞ -->
    </div>

    <div id="gift-bar">
        <!-- –°—é–¥–∞ –ø–∞–¥–∞—é—Ç –ø–æ–¥–∞—Ä–∫–∏ -->
    </div>

    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="start-modal" class="modal" style="display: flex;">
        <h1>–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ê–∫–∞–¥–µ–º–∏—è üöÄ</h1>
        <p>–¢–µ–±—è –∂–¥—É—Ç 3 —Ç–∏–ø–∞ –∏—Å–ø—ã—Ç–∞–Ω–∏–π:</p>
        <ul style="text-align: left; list-style: none; padding: 0; font-size: 1.1rem; line-height: 1.6;">
            <li>üß† <b>–ú–µ–º–æ—Ä–∏</b>: –ù–∞–π–¥–∏ –ø–∞—Ä—ã</li>
            <li>üî¢ <b>–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞</b>: –†–µ—à–∏ –ø—Ä–∏–º–µ—Ä</li>
            <li>‚òÑÔ∏è <b>–ê—Å—Ç–µ—Ä–æ–∏–¥—ã</b>: –°–±–µ–π –≤—Å–µ —Ü–µ–ª–∏</li>
        </ul>
        <button class="action-btn" onclick="game.start()">–ü–æ–µ—Ö–∞–ª–∏!</button>
    </div>

    <!-- –ü–æ–±–µ–¥–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ -->
    <div id="win-modal" class="modal">
        <h1>–£—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–π–¥–µ–Ω!</h1>
        <div id="win-gift" class="big-gift">üéÅ</div>
        <p id="win-msg">–¢—ã –ø–æ–ª—É—á–∏–ª –Ω–æ–≤—ã–π –ø—Ä–µ–¥–º–µ—Ç!</p>
        <button class="action-btn" onclick="game.nextLevel()">–î–∞–ª—å—à–µ</button>
    </div>

    <!-- –ü—Ä–æ–∏–≥—Ä—ã—à -->
    <div id="lose-modal" class="modal">
        <h1>–ú–∏—Å—Å–∏—è –ø—Ä–æ–≤–∞–ª–µ–Ω–∞ üòû</h1>
        <p>–í—Ä–µ–º—è –≤—ã—à–ª–æ –∏–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π.</p>
        <button class="action-btn" onclick="game.retry()">–ó–∞–Ω–æ–≤–æ</button>
    </div>

    <!-- –§–∏–Ω–∞–ª -->
    <div id="final-modal" class="modal">
        <h1>üèÜ –ö–ê–ü–ò–¢–ê–ù –ì–ê–õ–ê–ö–¢–ò–ö–ò! üèÜ</h1>
        <p>–¢—ã –ø—Ä–æ—à–µ–ª –≤—Å–µ 10 —É—Ä–æ–≤–Ω–µ–π!</p>
        <p>–§–∏–Ω–∞–ª—å–Ω—ã–π —Å—á–µ—Ç: <span id="final-score"></span></p>
        <div id="final-collection" style="margin: 20px; font-size: 2rem;"></div>
        <button class="action-btn" onclick="location.reload()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <script>
        const config = {
            icons: ['üëΩ', 'ü§ñ', 'üöÄ', 'ü™ê', 'üëæ', 'üõ∏', '‚≠ê', 'üåç', 'üîã', 'üî≠'],
            gifts: ['üß¢', 'üï∂Ô∏è', 'üõπ', 'üéÆ', 'üçî', 'üé∏', 'üèÜ', 'üì±', 'üö≤', 'üëë'],
            levels: [
                { type: 'memory', pairs: 2, time: 15, txt: '–†–∞–∑–º–∏–Ω–∫–∞ –ø–∞–º—è—Ç–∏' }, // 1
                { type: 'math', range: 10, ops: ['+'], time: 10, txt: '–í–∑–ª–æ–º–∞–π –∑–∞–º–æ–∫ (–°–ª–æ–∂–µ–Ω–∏–µ)' }, // 2
                { type: 'reaction', count: 5, time: 8, txt: '–°–±–µ–π 5 –∞—Å—Ç–µ—Ä–æ–∏–¥–æ–≤!' }, // 3
                { type: 'memory', pairs: 4, time: 30, txt: '–ë–æ–ª—å—à–µ –∫–∞—Ä—Ç' }, // 4
                { type: 'math', range: 20, ops: ['-', '+'], time: 15, txt: '–ö–æ–¥ —Å–ª–æ–∂–Ω–µ–µ' }, // 5
                { type: 'reaction', count: 8, time: 10, txt: '–ê—Å—Ç–µ—Ä–æ–∏–¥–Ω—ã–π –¥–æ–∂–¥—å!' }, // 6
                { type: 'memory', pairs: 6, time: 45, txt: '–°–ª–æ–∂–Ω–∞—è –ø–∞–º—è—Ç—å' }, // 7
                { type: 'math', range: 50, ops: ['+'], time: 10, txt: '–ë—ã—Å—Ç—Ä—ã–π —Å—á–µ—Ç' }, // 8
                { type: 'reaction', count: 12, time: 12, txt: '–ì–∏–ø–µ—Ä-—Å–∫–æ—Ä–æ—Å—Ç—å!' }, // 9
                { type: 'memory', pairs: 8, time: 50, txt: '–§–ò–ù–ê–õ: –ú–µ–≥–∞-–ø–∞–º—è—Ç—å' }  // 10
            ]
        };

        const game = {
            level: 0,
            score: 0,
            timer: null,
            timeLeft: 0,
            active: false,
            inventory: [],

            start() {
                document.getElementById('start-modal').style.display = 'none';
                this.loadLevel();
            },

            loadLevel() {
                const lvlData = config.levels[this.level];
                document.getElementById('lvl-val').innerText = this.level + 1;
                document.getElementById('game-area').innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª—è
                this.active = true;
                this.startTimer(lvlData.time);

                // –ó–∞–ø—É—Å–∫ –Ω—É–∂–Ω–æ–≥–æ –¥–≤–∏–∂–∫–∞ –∏–≥—Ä—ã
                if (lvlData.type === 'memory') this.initMemory(lvlData);
                if (lvlData.type === 'math') this.initMath(lvlData);
                if (lvlData.type === 'reaction') this.initReaction(lvlData);
            },

            startTimer(sec) {
                clearInterval(this.timer);
                this.timeLeft = sec;
                const maxTime = sec;
                
                const updateBar = () => {
                    const pct = (this.timeLeft / maxTime) * 100;
                    document.getElementById('timer-bar').style.width = pct + '%';
                };
                updateBar();

                this.timer = setInterval(() => {
                    if(!this.active) return;
                    this.timeLeft--;
                    updateBar();
                    if (this.timeLeft <= 0) this.gameOver();
                }, 1000);
            },

            win() {
                this.active = false;
                clearInterval(this.timer);
                this.score += (this.timeLeft * 10) + 100;
                document.getElementById('score-val').innerText = this.score;

                const gift = config.gifts[this.level];
                this.inventory.push(gift);
                this.renderGifts();

                const modal = document.getElementById('win-modal');
                document.getElementById('win-gift').innerText = gift;
                document.getElementById('win-msg').innerText = `–¢—ã –ø–æ–ª—É—á–∏–ª: ${gift}`;
                modal.style.display = 'flex';
            },

            gameOver() {
                this.active = false;
                clearInterval(this.timer);
                document.getElementById('lose-modal').style.display = 'flex';
            },

            retry() {
                document.getElementById('lose-modal').style.display = 'none';
                this.score = Math.max(0, this.score - 50); // –®—Ç—Ä–∞—Ñ
                document.getElementById('score-val').innerText = this.score;
                this.loadLevel();
            },

            nextLevel() {
                document.getElementById('win-modal').style.display = 'none';
                this.level++;
                if (this.level >= config.levels.length) {
                    this.finalScreen();
                } else {
                    this.loadLevel();
                }
            },

            renderGifts() {
                const bar = document.getElementById('gift-bar');
                bar.innerHTML = this.inventory.map(g => `<div class="gift-item">${g}</div>`).join('');
            },

            finalScreen() {
                document.getElementById('final-score').innerText = this.score;
                document.getElementById('final-collection').innerText = this.inventory.join(' ');
                document.getElementById('final-modal').style.display = 'flex';
            },

            /* --- –î–≤–∏–∂–æ–∫ –ú–ï–ú–û–†–ò --- */
            initMemory(data) {
                const grid = document.createElement('div');
                grid.className = 'memory-grid';
                // –ê–¥–∞–ø—Ç–∏–≤ —Å–µ—Ç–∫–∏
                if(data.pairs <= 2) grid.style.gridTemplateColumns = 'repeat(2, 1fr)';
                else if(data.pairs <= 4) grid.style.gridTemplateColumns = 'repeat(3, auto)';
                else grid.style.gridTemplateColumns = 'repeat(4, auto)';

                let icons = config.icons.slice(0, data.pairs);
                let cards = [...icons, ...icons].sort(() => Math.random() - 0.5);
                
                let flipped = [];
                let matched = 0;

                cards.forEach(icon => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <div class="card-face card-front">?</div>
                        <div class="card-face card-back">${icon}</div>
                    `;
                    card.onclick = () => {
                        if (!this.active || card.classList.contains('flipped') || flipped.length >= 2) return;
                        
                        card.classList.add('flipped');
                        flipped.push({ el: card, icon: icon });

                        if (flipped.length === 2) {
                            if (flipped[0].icon === flipped[1].icon) {
                                matched++;
                                flipped = [];
                                if (matched === data.pairs) this.win();
                            } else {
                                setTimeout(() => {
                                    flipped.forEach(f => f.el.classList.remove('flipped'));
                                    flipped = [];
                                }, 800);
                            }
                        }
                    };
                    grid.appendChild(card);
                });
                document.getElementById('game-area').appendChild(grid);
            },

            /* --- –î–≤–∏–∂–æ–∫ –ú–ê–¢–ï–ú–ê–¢–ò–ö–ò --- */
            initMath(data) {
                const n1 = Math.floor(Math.random() * data.range) + 5;
                const n2 = Math.floor(Math.random() * data.range) + 1;
                const op = data.ops[Math.floor(Math.random() * data.ops.length)];
                
                let ans = (op === '+') ? n1 + n2 : n1 - n2;
                
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∞
                let options = new Set([ans]);
                while(options.size < 4) {
                    let fake = ans + Math.floor(Math.random() * 10) - 5;
                    if(fake > 0 && fake !== ans) options.add(fake);
                }
                let optionsArr = Array.from(options).sort(() => Math.random() - 0.5);

                const container = document.createElement('div');
                container.className = 'math-container';
                container.innerHTML = `
                    <div style="color: #aaa; margin-bottom:10px">${data.txt}</div>
                    <div class="math-problem">${n1} ${op} ${n2} = ?</div>
                    <div class="math-options">
                        ${optionsArr.map(opt => `<button class="math-btn" onclick="game.checkMath(${opt}, ${ans})">${opt}</button>`).join('')}
                    </div>
                `;
                document.getElementById('game-area').appendChild(container);
            },

            checkMath(selected, correct) {
                if (!this.active) return;
                if (selected === correct) {
                    this.win();
                } else {
                    // –¢—Ä—è—Å–∫–∞ —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ –∫—Ä–∞—Å–Ω—ã–π —Ü–≤–µ—Ç
                    const prob = document.querySelector('.math-problem');
                    prob.style.color = '#ff7675';
                    setTimeout(() => prob.style.color = 'white', 500);
                    this.timeLeft -= 3; // –®—Ç—Ä–∞—Ñ –∑–∞ –æ—à–∏–±–∫—É
                }
            },

            /* --- –î–≤–∏–∂–æ–∫ –†–ï–ê–ö–¶–ò–ò (–ê—Å—Ç–µ—Ä–æ–∏–¥—ã) --- */
            initReaction(data) {
                const field = document.createElement('div');
                field.className = 'asteroid-field';
                let remaining = data.count;

                const spawnAsteroid = () => {
                    if (!this.active || remaining <= 0) return;
                    
                    // –°–æ–∑–¥–∞–µ–º —Å—Ä–∞–∑—É –≤—Å–µ –∏–ª–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏? –°–¥–µ–ª–∞–µ–º —Å—Ä–∞–∑—É –≤—Å–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
                };

                for(let i=0; i<data.count; i++) {
                    const ast = document.createElement('div');
                    ast.className = 'asteroid';
                    ast.innerText = ['‚òÑÔ∏è', 'üåë', 'üõ∏'][Math.floor(Math.random()*3)];
                    
                    // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                    ast.style.top = Math.random() * 80 + '%';
                    ast.style.left = Math.random() * 80 + '%';
                    // –†–∞–∑–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
                    ast.style.animationDuration = (2 + Math.random() * 3) + 's';

                    ast.onclick = (e) => {
                        if(!this.active) return;
                        e.target.style.transform = 'scale(0) rotate(360deg)';
                        setTimeout(() => e.target.remove(), 200);
                        remaining--;
                        if(remaining === 0) this.win();
                    };
                    field.appendChild(ast);
                }
                
                // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
                const hint = document.createElement('div');
                hint.style.position = 'absolute';
                hint.style.bottom = '10px';
                hint.style.width = '100%';
                hint.style.textAlign = 'center';
                hint.style.color = '#aaa';
                hint.innerText = `–¶–µ–ª–µ–π –æ—Å—Ç–∞–ª–æ—Å—å: ${remaining}`;
                field.appendChild(hint);

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞
                field.addEventListener('click', () => {
                    hint.innerText = `–¶–µ–ª–µ–π –æ—Å—Ç–∞–ª–æ—Å—å: ${remaining}`;
                });

                document.getElementById('game-area').appendChild(field);
            }
        };
    </script>
</body>
</html>
